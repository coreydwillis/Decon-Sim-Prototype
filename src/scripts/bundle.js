// Harlowe Macro Framework, by Chapel; version 1.0.2
;!function(){"use strict";var r={major:1,minor:0,patch:2},e=[r.major,r.minor,r.patch].join(".");r.semantic=e,r=Object.freeze(r);var t=$("tw-storydata"),a=Object.freeze({name:t.attr("name"),ifid:t.attr("ifid")}),n=t.attr("format-version"),o=n.split("."),i=Object.freeze({major:o[0],minor:o[1],patch:o[2],semantic:n});window.Harlowe=window.Harlowe||{},window.Harlowe=Object.assign(window.Harlowe,{framework:r,API_ACCESS:Object.freeze({MACROS:require("macros"),STATE:require("state"),CHANGER:require("datatypes/changercommand"),ENGINE:require("engine")}),engine:i,story:a})}(),function(){"use strict";function e(r){return"number"==typeof r||"boolean"==typeof r||"string"==typeof r||null===r||Array.isArray(r)&&r.every(e)||r instanceof Set&&Array.from(r).every(e)||r instanceof Map&&Array.from(r.values()).every(e)||_changer.isPrototypeOf(r)}window.Harlowe=Object.assign(window.Harlowe,{helpers:{isSerialisable:e,isSerializable:e,arrayify:function(r,e){if(r){var t=[].slice.call(r);return void 0!==e&&(t=t.slice(e)),t}},getPassageData:function(r){var e=$('tw-passagedata[name="'+r+'"]');if(e[0])return e}}})}(),function(){"use strict";var n=window.localStorage||!1,o=Harlowe.story.ifid+"-tw-storage";function r(){try{if(!n)throw new Error("storage is inaccessible");n.setItem(o,JSON.stringify({ifid:Harlowe.story.ifid}))}catch(r){console.warn(r)}}function i(r){try{var e;if(n)return e=JSON.parse(n.getItem(o)),r&&r&&"string"==typeof r?e[r]:e;throw new Error("storage is inaccessible")}catch(r){console.warn(r)}}null==i()&&r(),Harlowe.storage={clear:r,save:function(r,e){try{if(!r||"string"!=typeof r)throw new TypeError("cannot store values without a valid storage key");if(void 0===e)throw new TypeError("cannot store undefined values");var t={};if(t[r]=e,!n)throw new Error("storage is inaccessible");var a=i();Object.assign(a,t),n.setItem(o,JSON.stringify(a))}catch(r){console.warn(r)}},load:i,remove:function(r){try{if(!r||"string"!=typeof r)throw new TypeError("cannot store values without a valid storage key");if(!n)throw new Error("storage is inaccessible");var e=i();e.hasOwnProperty(r)&&(delete e[r],n.setItem(o,JSON.stringify(e)))}catch(r){console.warn(r)}}}}(),function(){"use strict";function a(r,e,t){if(!(this instanceof a))return new a(r,e,t);this.name=r||"unknown",this.args=e||[],this.data=t||{},this.type=t&&t.type||"basic",this.fn=t&&t.fn||"handler","changer"===this.type&&("handler"===this.fn?this.instance=t&&t.instance||null:this.descriptor=t&&t.descriptor||null)}a.create=function(r,e,t){if(!r||"string"!=typeof r||!r.trim())throw new TypeError("Invalid macro name.");return e&&e instanceof Array||(e=[]),t&&"object"==typeof t||(t={type:"basic",fn:"handler"}),new a(r,e,t)},Object.assign(a.prototype,{clone:function(){return a.create(this.name,this.args,this.data)},syntax:function(){return"("+this.name+":)"},error:function(r,e){var t="Error in the "+this.syntax()+" macro: "+r;return e&&alert(t),console.warn("HARLOWE CUSTOM MACRO ERROR -> ",t),new Error(r)},typeCheck:function(r){r&&r instanceof Array||(r=Harlowe.helpers.arrayify(arguments));var n=this,o=[];if(r.forEach(function(r,e){var t=e+1,a=[];"string"==typeof r&&("any"===(a=r.includes("|")?r.split("|").map(function(r){return r.trim().toLowerCase()}):[r.trim().toLowerCase()])[0]||a.some(function(r){return typeof n.args[e]===r})||o.push("argument "+t+" should be a(n) "+a.join(" or ")))}),o.length)return n.error(o.join("; "))}}),window.Harlowe=Object.assign(window.Harlowe,{MacroContext:a})}(),function(){"use strict";var c=Harlowe.API_ACCESS.MACROS,l=Harlowe.API_ACCESS.CHANGER;window.Harlowe=Object.assign(window.Harlowe||{},{macro:function(r,e,t){if(!r||"string"!=typeof r||!r.trim())throw new TypeError("Invalid macro name.");if(!e||"function"!=typeof e)throw new TypeError("Invalid macro handler.");var a,n,o,i,s;t&&"function"==typeof t?(o=r,i=e,s=t,c.addChanger(o,function(){var r=Harlowe.helpers.arrayify(arguments,1),e=l.create(o,r),t=Harlowe.MacroContext.create(o,r,{type:"changer",fn:"handler",instance:e});return i.apply(t,r),e},function(){var r=Harlowe.helpers.arrayify(arguments),e=r.shift(),t=Harlowe.MacroContext.create(o,r,{type:"changer",fn:"changer",descriptor:e});s.apply(t,r)},c.TypeSignature.zeroOrMore(c.TypeSignature.Any))):(a=r,n=e,c.add(a,function(){var r=Harlowe.helpers.arrayify(arguments,1),e=Harlowe.MacroContext.create(a,r,{type:"basic",fn:"handler"}),t=n.apply(e,r);return null==t?"":t},c.TypeSignature.zeroOrMore(c.TypeSignature.Any)))}})}(),function(){"use strict";var t=Harlowe.API_ACCESS.STATE,e=Harlowe.API_ACCESS.ENGINE;function a(){return t.passage}window.Harlowe=Object.assign(window.Harlowe||{},{passage:a,tags:function(r){r=r||a();try{var e=Harlowe.helpers.getPassageData(r).attr("tags");return e?e.split(" "):[]}catch(r){return console.warn(r.message),[]}},goto:function(r){return e.goToPassage(r)},variable:function(r,e){if("$"!==r[0])throw new Error('cannot access variable "'+r+'"');if(r=r.substr(1),void 0!==e){if(!Harlowe.helpers.isSerialisable(e))throw new Error('The value passed to variable "'+r+'" cannot be serialized.');t.variables[r]=e}return t.variables[r]},visited:function(r){return t.passageNameVisited(r||a())},hasVisited:function(r){return 0<t.passageNameVisited(r||a())},turns:function(){return t.pastLength}})}();
// end Harlowe Macro Framework
// notify.min.js, for Harlow Macro API, by Chapel
;!function(){var i=/^([+-]?(?:\d*\.)?\d+)([Mm]?[Ss])$/,a=$(document.createElement("div")).attr("id","notify").appendTo(document.body);function r(e,n,t){return"string"==typeof e?e=function(e){var n=i.exec(String(e));if(null===n)throw new SyntaxError("invalid time value syntax: "+e);var t=Number(n[1]);if(1===n[2].length&&(t*=1e3),Number.isNaN(t)||!Number.isFinite(t))throw new RangeError("invalid time value: "+e);return t}(e):"number"!=typeof e&&(e=!1),$(document).trigger({type:":notify",message:t,delay:e,class:n||""}),a}$(document).on(":notify",function(e){e.class?"string"==typeof e.class?e.class="open macro-notify "+e.class:Array.isArray(e.class)?e.class="open macro-notify "+e.class.join(" "):e.class="open macro-notify":e.class="open macro-notify",e.delay?("number"!=typeof e.delay&&(e.delay=Number(e.delay)),Number.isNaN(e.delay)&&(e.delay=2e3)):e.delay=2e3,a.empty().append(e.message).addClass(e.class),setTimeout(function(){a.removeClass()},e.delay)}),Harlowe.macro("notify",function(){var e=this.typeCheck(["string|number|undefined","string|undefined","string|undefined"]);if(e)throw e},function(e,n,t){this.descriptor.target.addClass("in-notification"),n&&t&&(n=Harlowe.helpers.arrayify(arguments,1).join(" ")),r(e,n,this.descriptor.target)}),window.setup=window.setup||{},window.setup.notify=r}();
// end notify.min.js
// achievements.min.js, for Harlow Macro API, by Chapel
;!function(){"use strict";var r="tw-achievements",t=Harlowe.storage.load(r)||[];function e(n){t.includes(n)||(t.push(n),Harlowe.storage.save(r,t))}function n(){t=[],Harlowe.storage.remove(r)}function o(n){return t.join(n||"\n")}function a(){return t.length}function c(n){return t.includes(n)}Harlowe.macro("achadd",function(n){var r=this.typeCheck(["string"]);if(r)throw r;e(n)}),Harlowe.macro("achcount",function(){return a()}),Harlowe.macro("achhas",function(n){var r=this.typeCheck(["string"]);if(r)throw r;return c(n)}),Harlowe.macro("achprint",function(n){var r=this.typeCheck(["string|undefined"]);if(r)throw r;return o(n)}),Harlowe.macro("achievements",function(){return t}),Harlowe.macro("achclear",function(){return n()}),window.setup=window.setup||{},Object.assign(window.setup,{achievements:{list:t,add:e,count:a,has:c,print:o,clear:n,load:function(){var n=Harlowe.storage.load(r)||[];return t=n}}})}();
// end achievements.min.js
// articles.min.js, for Harlow Macro API, by Chapel
;!function(){"use strict";var t=new Map,o=["eunuch","eucalyptus","eugenics","eulogy","euphemism","euphony","euphoria","eureka","european","euphemistic","euphonic","euphoric","euphemistically","euphonically","euphorically","heir","heiress","herb","homage","honesty","honor","honour","hour","honest","honorous","honestly","hourly","one","ouija","once","ubiquitous","ugandan","ukrainian","unanimous","unicameral","unified","unique","unisex","universal","urinal","urological","useful","useless","usurious","usurped","utilitarian","utopic","ubiquitously","unanimously","unicamerally","uniquely","universally","urologically","usefully","uselessly","usuriously"],u=["a","an"],a=/[aeiou8]/i,s=/[A-Z]+$/,l=/[UFHLMNRSX]/,r=/[.,\/#!$%\^&\*;:{}=\-_`~()]/g;function c(e){return"a"===e?"an":"a"}function h(e,i,r){var n;return i&&"string"==typeof i?(e&&"string"==typeof e&&(e=e.toLowerCase().trim()),u.includes(e)?(i=i.trim(),void(r?t.set(i,{article:e,caseSensitive:!!r}):t.set(i.toLowerCase(),{article:e,caseSensitive:!!r}))):(n='cannot add article override -> invalid article, must be "a" or "an"',console.error(n),n)):(n="cannot add article override -> invalid word",console.error(n),n)}function n(e){var i,r,n,t,u;return i=a.test(e.charAt(0))?"an":"a",t=e,u=i,!!o.includes(t.toLowerCase())&&c(u)||(r=e,n=i,!(!s.test(r)||!l.test(r.charAt(0)))&&c(n))||i}function p(e){if(e&&"string"==typeof e){var i=e.trim().split(" ")[0].trim();return function(e){var i=(e=e.trim()).toLowerCase();if(t.has(i)||t.has(e)){var r=t.get(i)||t.get(e);return r.caseSensitive&&!t.has(e)?null:r.article}return null}(i=i.replace(r,""))||n(i)}}function d(e,i){if(!e||"string"!=typeof e)return e;var r=p(e);return(i?r.charAt(0).toUpperCase()+r.substring(1):r)+" "+e}window.setup=window.setup||{},Object.assign(window.setup,{find:p,output:d,override:h}),Harlowe.macro("article",function(e,i){var r=this.typeCheck(["string","boolean|undefined"]);if(r)throw r;return d(e,i)}),Harlowe.macro("setarticle",function(e,i,r){var n=this.typeCheck(["string","string","boolean|undefined"]);if(n)throw n;if(!u.includes(e.toLowerCase().trim()))throw this.error('invalid article in first argument--must be "a" or "an"');h(e,i,r)})}();
// end articles.min.js
// dice.min.js, for Harlow Macro API, by Chapel
;!function(){"use strict";var m=/(\d+)d(\d+|f)(\s*([+-])\s*(\d+))?/i,d=["roll","amount","type","mod_whole","mod_sign","mod_value"];function a(r,e,n,t){var o=function(r,e,n){n&&"function"==typeof n||(n=Math.random);var t=1,o=0,i=[];if(r=Number(r),"string"==typeof e&&"F"===e.trim().toUpperCase()?(e=3,t=-1):e=Number(e),[r,e,t].some(function(r){return Number.isNaN(r)}))throw new TypeError("could not process arguments in dice roll");for(var u=0;u<r;u++){var f,m=n();if("number"!=typeof m||1<m||m<0)throw new TypeError("invalid random function--should return a value between 0 and 1");f=Math.floor(m*e)+t,i.push(f),o+=f}return{rolls:i,result:o}}(r,e,t).result;return n&&(o+=n),o}function o(r,e,n){var t,o,i,u,f={};return"string"==typeof r?(t=function(r){if(r&&"string"==typeof r){var e=r.trim().toLowerCase();if(e&&e.includes("d")){var n=m.exec(e);if(n&&n instanceof Array&&n.length){var t={};return d.forEach(function(r,e){t[r]=n[e]||""}),t}}}}(r),o=Number(t.amount),i=Number(t.type),u=Number(t.mod_value),"-"===t.mod_sign.trim()&&(u*=-1),f={number:o,type:i,modifier:u}):(f.number=r,f.type=e),!f.modifier&&n&&"number"==typeof n?f.modifier=n||0:f.modifier||(f.modifier=0),a(f.number,f.type,f.modifier,null)}Harlowe.macro("dice",function(r,e,n){var t=this.typeCheck(["string|number","number|undefined","number|undefined"]);if(t)throw t;return o(r,e,n)}),window.setup=window.setup||{},Object.assign(window.setup,{dice:o})}();
// end dice.min.js